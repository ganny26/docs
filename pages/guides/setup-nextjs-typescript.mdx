import Guide from '~/components/layout/guide'
import { TerminalInput } from '~/components/text/terminal'
import { Image } from '~/components/media'
import Caption from '~/components/text/caption'
import { InlineCode } from '~/components/text/code'
import Card from '~/components/card'
import Note from '~/components/text/note'
import { GenericLink } from '~/components/text/link'

export const meta = {
  title: 'Setup Next JS with Typescript integration',
  description: 'Learn how to setup Next JS typescript integration',
  published: '2019-04-20T13:25:45.443Z',
  authors: ['ganny26'],
  url: '/guides/setup-nextjs-typescript',
  editUrl: 'pages/guides/setup-nextjs-typescript.mdx',
  lastEdited: '2019-04-20T15:03:43.000Z'
}

This guide will walk you through how to set up the Next JS with Typescript integration for your projects.

## Step 1: Set Up Your Next JS Project

Create a new folder name `nextjs-typescript` and `cd nextjs-typescript`

<TerminalInput>mkdir nextjs=typescript && cd nextjs=typescript</TerminalInput>

Now create `package.json` using command `yarn init --yes` or `npm init --yes`

<TerminalInput>yarn init --yes</TerminalInput>

Install the required dependencies from your terminal:

<TerminalInput>yarn add next react react-dom</TerminalInput>

## Step 2: Install required @types module

That @types/ prefix means that we also want to get the declaration files for React and React-DOM. Usually when you import a path like "react", it will look inside of the react package itself; however, not all packages include declaration files, so TypeScript also looks in the @types/react package as well.

Next JS has official [@zeit/next-typescript](https://github.com/zeit/next-plugins/tree/master/packages/next-typescript) module

<TerminalInput>
  yarn add @zeit/next-typescript @types/next @types/react @zeit/next-typescript
  @types/next @types/react
</TerminalInput>

## Step 3: Create configuration files

Create a `next.config.js` in your project

```js
// next.config.js
const withTypescript = require('@zeit/next-typescript')
module.exports = withTypescript()
```

Create a `.babelrc` in your project

```json
{
  "presets": ["next/babel", "@zeit/next-typescript/babel"]
}
```

Create a `tsconfig.json` in your project

```json
{
  "compilerOptions": {
    "allowJs": true,
    "allowSyntheticDefaultImports": true,
    "jsx": "preserve",
    "lib": ["dom", "es2017"],
    "module": "esnext",
    "moduleResolution": "node",
    "noEmit": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "preserveConstEnums": true,
    "removeComments": false,
    "skipLibCheck": true,
    "sourceMap": true,
    "strict": true,
    "target": "esnext"
  }
}
```

Optionally you can add your custom Next.js configuration as parameter

```js
// next.config.js
const withTypescript = require('@zeit/next-typescript')
module.exports = withTypescript({
  webpack(config, options) {
    return config
  }
})
```

The next step in this set up is to add a `scripts` property to the `package.json` file that was generated in the installation above. The property will [include a script to run a local server](https://nextjs.org/docs/#setup) for development of your project:

```json
{
  ...
  "scripts": {
    "dev": "next"
  }
}
```

## Step 4: Create Shared layout

Create a common Layout component and use it in multiple pages.

Create new `components` directory and then within that directory, create an `Layout.tsx` with the following contents:

```js
import * as React from 'react'
import Link from 'next/link'
import Head from 'next/head'

type LayoutProps = {
  title?: string
}

const layoutStyle = {
  margin: 20,
  padding: 20,
  border: '1px solid #DDD'
}

const Layout: React.FunctionComponent<LayoutProps> = ({ children, title }) => (
  <div style={layoutStyle}>
    <Head>
      <title>{title}</title>
      <meta charSet="utf-8" />
      <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    </Head>
    <header>
      <nav>
        <Link href="/">
          <a>Home</a>
        </Link>{' '}
        |{' '}
        <Link href="/about">
          <a>About</a>
        </Link>{' '}
        |{' '}
      </nav>
    </header>
    {children}
  </div>
)

export default Layout
```

## Step 5: Create Pages layout

Create new `pages` directory and then within that directory, create an `index.tsx,about.tsx,post.tsx` with the following contents:

```js
import React from 'react'
import Layout from '../components/Layout'

const Index: React.FunctionComponent = () => {
  return (
    <Layout title="Home">
      <h1>Hello Next.js ðŸ‘‹</h1>
    </Layout>
  )
}

export default Index
```

<Caption>index.tsx</Caption>

```js
import React from 'react'
import Layout from '../components/Layout'
import Link from 'next/link'

type PostLinkProps = {
  title?: string
}

const PostLink: React.FunctionComponent<PostLinkProps> = ({ title }) => {
  return (
    <li>
      <Link href={`/post?title=${title}`}>
        <a>{title}</a>
      </Link>
    </li>
  )
}

const About: React.FunctionComponent = () => {
  return (
    <Layout title="About">
      <h1>This is About page âœŒ</h1>
      <PostLink title="Hello Next.js" />
      <PostLink title="Learn Next.js is awesome" />
      <PostLink title="Deploy apps with Zeit" />
    </Layout>
  )
}

export default About
```

<Caption>about.tsx</Caption>

```js
import { withRouter } from 'next/router'
import Layout from '../components/Layout'

type PostProps = {
  router?: any
}

const Post: React.FunctionComponent<PostProps> = ({ router }) => {
  return (
    <Layout>
      <h1>{router.query.title}</h1>
      <p>This is the blog post content.</p>
    </Layout>
  )
}

export default withRouter(Post)
```

<Caption>post.tsx</Caption>

## Step 6: Deploy Your Next.js Project with Now

With your Next.js project set up, you are ready to deploy your app with [Now](/now).

If you have not yet installed Now, you can do so by installing the [Now Desktop app](/docs/v2/getting-started/installation/#now-desktop) which installs Now CLI automatically, or by [installing Now CLI](/docs/v2/getting-started/installation/#now-cli) directly.

```js
module.exports = withTypescript({
  target: 'serverless',
  webpack: (config, options) => {
    config.plugins = config.plugins || []
    return config
  }
})
```

<Caption>
  Setting the Next.js build target to "serverless" to enable serverless builds.
</Caption>

Serverless Next.js is more performant and provides more stability on serverless platforms, such as Now.

Next, you will need to tell Now what the entrypoint is for the application and what Builder it should use to build and deploy the application so it will act as you would expect.

You will need to create a [`now.json` configuration file](https://zeit.co/docs/v2/deployments/configuration) to instruct Now on how to handle your application in the build phase and when being served to visitors.

```json
{
  "version": 2,
  "name": "my-nextjs-app",
  "builds": [{ "src": "next.config.js", "use": "@now/next" }]
}
```

<Caption>
  A <InlineCode>now.json</InlineCode> configuration file that specifies the
  Next.js Builder.
</Caption>

The above `now.json` file achieves a few things:

- Defines a `version` property to ensure you are using the latest [Now 2.0 platform](/docs/v2/platform/overview) version.
- Defines a project `name` that your deployments will be sorted under and known by under Now.
- Defines a `builds` property as an array with one build step using `@now/next` to instruct Now to build the project and deploy the [output](/docs/v2/deployments/builds#sources-and-outputs). Using the `package.json` file as an entrypoint, [more on that below](#build-instruction).

To ensure a fresh build of your Next.js project gets built by Now, especially if you only deploy the source code, you can add a `now-build` script to your `package.json` file:

```json
{
  ...
  "scripts": {
    ...
    "now-build": "next build"
  }
}
```

<Note>
  Don't forget to exclude the <InlineCode>.next</InlineCode> and{' '}
  <InlineCode>node_modules</InlineCode> directories from being uploaded to Now
  to prevent unintended side effects and to enable faster deployment. To do so,
  add a{' '}
  <GenericLink href="/guides/prevent-uploading-sourcepaths-with-nowignore/">
    .nowignore
  </GenericLink>{' '}
  file to the root of the project directory and add both{' '}
  <InlineCode>node_modules</InlineCode> and <InlineCode>.next</InlineCode> to it
  on separate lines.
</Note>

### Deploying with Now

You are now ready to deploy the app with Now:

<TerminalInput>now</TerminalInput>
<Caption>Deploying your Next.js app with Now CLI from a terminal.</Caption>

Once the app is deployed, you will receive a deployment URL similar to the following (styled for effect, with an additional page): <https://next-js-typescript.selvaganesh93.now.sh/>

## Resources

For more information on working with Next.js, please refer to [the Next.js documentation](https://nextjs.org/docs).

To configure Now further, please see these additional topics and guides:

<Card title="Deploying Basics" href="/docs/v2/deployments/basics">
  Deploy any of your applications with ZEIT Now.
</Card>

<Card
  title="@now/next Builder"
  href="/docs/v2/deployments/official-builders/next-js-now-next"
>
  The Now Builder for Next.js.
</Card>

<Card
  title="Deploying with Custom Next.js Routes"
  href="/guides/custom-next-js-server-to-routes"
>
  Custom Routes with Next.js and Now
</Card>

<Card
  title="Aliasing"
  href="/docs/v2/domains-and-aliases/aliasing-a-deployment/"
>
  Learn more about aliasing to your deployments.
</Card>

<Card title="More Guides" href="/guides">
  See more guides that help you move forward with your projects and deployments.
</Card>

export default ({ children }) => <Guide meta={meta}>{children}</Guide>
